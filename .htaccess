# Enable URL rewriting
RewriteEngine On
RewriteBase /

# Explicitly serve static assets (JS, CSS, images) directly
RewriteCond %{REQUEST_URI} \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|pdf)$ [NC]
RewriteRule ^ - [L]

# Serve static files and directories directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Handle client-side routing for React Router
RewriteRule ^ /index.html [L]

# MIME types
<IfModule mod_mime.c>
    AddType application/javascript .js .mjs
    AddType text/css .css
    AddType image/svg+xml .svg
    AddType image/x-icon .ico
</IfModule>

# Increase timeout limits
<IfModule mod_fcgid.c>
    FcgidIOTimeout 300
    FcgidConnectTimeout 300
    FcgidBusyTimeout 300
    FcgidIdleTimeout 300
</IfModule>

# Disable gzip ONLY if connection resets persist
# <IfModule mod_deflate.c>
#     SetEnvIfNoCase Request_URI \.js$ no-gzip
# </IfModule>

# Enable gzip compression (excluding JS files to prevent connection resets)
<IfModule mod_deflate.c>
    # Compress text files
    AddOutputFilterByType DEFLATE text/html text/css text/plain text/xml
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml application/rss+xml
    
    # DO NOT compress JavaScript files - causes connection resets on shared hosting
    # AddOutputFilterByType DEFLATE application/javascript application/x-javascript text/javascript
</IfModule>

# Cache control
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevent access to sensitive files
<FilesMatch "\.(htaccess|json|ts|tsx|jsx|env)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Error pages
ErrorDocument 404 /index.html